<section class="clinic-admin-page">
  <header class="clinic-hero">
    <p class="eyebrow">{{ 'roles.admin' | translate }}</p>
    <h1>{{ 'clinicManagement.title' | translate }}</h1>
    <p>{{ 'clinicManagement.subtitle' | translate }}</p>

    <div class="hero-actions">
      <a mat-flat-button routerLink="/dashboard/admin/users">{{ 'actions.manageUsers' | translate }}</a>
      <a mat-stroked-button routerLink="/dashboard/appointments/all">{{ 'actions.viewAppointments' | translate }}</a>
    </div>
  </header>

  <section class="clinic-metrics">
    <mat-card>
      <span>{{ 'metrics.totalClinics' | translate }}</span>
      <strong>{{ totalClinics }}</strong>
    </mat-card>
    <mat-card>
      <span>{{ 'statuses.active' | translate }}</span>
      <strong>{{ activeClinics }}</strong>
    </mat-card>
    <mat-card>
      <span>{{ 'statuses.inactive' | translate }}</span>
      <strong>{{ inactiveClinics }}</strong>
    </mat-card>
    <mat-card>
      <span>{{ 'metrics.mappedUsers' | translate }}</span>
      <strong>{{ mappedUsersCount }}</strong>
    </mat-card>
  </section>

  @if (loading && clinics.length > 0) {
    <p class="state">{{ 'state.working' | translate }}</p>
  }
  @if (errorMessage) {
    <p class="error">{{ errorMessage | translate }}</p>
  }
  @if (successMessage) {
    <p class="success">{{ successMessage | translate }}</p>
  }

  <section class="editor-toolbar">
    <div class="toolbar-copy">
      <h2>{{ 'clinicManagement.modalsTitle' | translate }}</h2>
      <p>{{ 'clinicManagement.modalsSubtitle' | translate }}</p>
    </div>
    <button mat-flat-button type="button" [disabled]="loading" (click)="openCreateClinicDialog()">{{ 'actions.addClinic' | translate }}</button>
  </section>

  <mat-card class="panel directory-panel" [attr.aria-busy]="loading">
    <h2>{{ 'clinicManagement.directoryTitle' | translate }}</h2>
    <p class="panel-subtitle">{{ 'clinicManagement.directorySubtitle' | translate }}</p>

    @if (loading && clinics.length === 0) {
      <section class="skeleton-cards" aria-hidden="true">
        @for (_ of skeletonCards; track $index) {
          <article class="skeleton-card">
            <div class="skeleton-line skeleton-line--title"></div>
            <div class="skeleton-line skeleton-line--meta"></div>
            <div class="skeleton-pills">
              <span class="skeleton-pill"></span>
              <span class="skeleton-pill"></span>
              <span class="skeleton-pill"></span>
            </div>
          </article>
        }
      </section>
    }

    @if (!loading && clinics.length === 0) {
      <section class="empty-state">
        {{ 'clinicManagement.empty' | translate }}
      </section>
    }

    @if (clinics.length > 0) {
      <section class="clinic-cards">
        @for (clinic of clinics; track trackClinic($index, clinic)) {
          <article class="clinic-card">
            <div class="clinic-main">
              <div class="clinic-title">
                <h3>{{ clinic.name }}</h3>
                <span [class]="getStatusClass(clinic.isActive)">
                  {{ clinic.isActive ? ('statuses.active' | translate) : ('statuses.inactive' | translate) }}
                </span>
              </div>
              <div class="clinic-meta">
                <span>{{ 'common.code' | translate }}: {{ clinic.code }}</span>
                <span>{{ 'clinicManagement.usersCount' | translate:{ count: clinic.usersCount } }}</span>
                @if (clinic.city || clinic.state) {
                  <span>{{ clinic.city }}{{ clinic.city && clinic.state ? ', ' : '' }}{{ clinic.state }}</span>
                }
                @if (clinic.sysClinicTypeId > 0) {
                  <span>{{ getClinicTypeDisplayName(clinic) }}</span>
                }
              </div>
            </div>
            <button mat-stroked-button type="button" [disabled]="loading" (click)="openEditClinicDialog(clinic)">{{ 'common.edit' | translate }}</button>
          </article>
        }
      </section>
    }
  </mat-card>
</section>
