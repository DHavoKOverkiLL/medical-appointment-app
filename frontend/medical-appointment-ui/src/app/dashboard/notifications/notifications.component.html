<section class="notifications-page">
  <header class="notifications-hero">
    <p class="eyebrow">{{ 'nav.notifications' | translate }}</p>
    <h1>{{ 'notifications.title' | translate }}</h1>
    <p>{{ 'notifications.subtitle' | translate }}</p>
  </header>

  <mat-card class="notifications-toolbar">
    <div>
      <h2>{{ 'notifications.inbox' | translate }}</h2>
      <p>{{ 'notifications.unreadSummary' | translate:{ count: unreadCount } }}</p>
    </div>

    <button
      mat-flat-button
      type="button"
      [disabled]="loading || markingAll || unreadCount === 0"
      (click)="markAllAsRead()">
      <mat-progress-spinner *ngIf="markingAll" diameter="16" mode="indeterminate"></mat-progress-spinner>
      <span>{{ 'actions.markAllAsRead' | translate }}</span>
    </button>
  </mat-card>

  <mat-card class="notifications-preferences">
    <div class="notifications-preferences__content">
      <h3>{{ 'notifications.preferences.title' | translate }}</h3>
      <p>{{ 'notifications.preferences.hint' | translate }}</p>

      <label class="notifications-preferences__toggle">
        <input type="checkbox" [checked]="soundAlertsEnabled" (change)="onSoundAlertsChange($event)" />
        <span>{{ 'notifications.preferences.sound' | translate }}</span>
      </label>

      <label class="notifications-preferences__toggle">
        <input type="checkbox" [checked]="vibrationAlertsEnabled" (change)="onVibrationAlertsChange($event)" />
        <span>{{ 'notifications.preferences.vibration' | translate }}</span>
      </label>
    </div>

    <button
      mat-stroked-button
      type="button"
      [disabled]="!soundAlertsEnabled && !vibrationAlertsEnabled"
      (click)="testAlertCue()">
      {{ 'actions.testAlert' | translate }}
    </button>
  </mat-card>

  <p *ngIf="loading" class="state">{{ 'notifications.loading' | translate }}</p>
  <p *ngIf="successMessage" class="success">{{ successMessage | translate }}</p>
  <p *ngIf="errorMessage" class="error">{{ errorMessage | translate }}</p>

  <section *ngIf="!loading && !errorMessage && notifications.length === 0" class="empty-state">
    {{ 'notifications.empty' | translate }}
  </section>

  <section *ngIf="!loading && notifications.length > 0" class="notifications-list">
    <mat-card
      class="notification-card"
      [class.notification-card--read]="notification.isRead"
      *ngFor="let notification of notifications; trackBy: trackNotification">
      <div class="notification-card__head">
        <div>
          <h3>{{ notification.title }}</h3>
          <p>{{ notification.createdAtUtc | date:'dd/MM/yyyy HH:mm' }}</p>
        </div>
        <span class="status-chip" [class.status-chip--read]="notification.isRead">
          {{ (notification.isRead ? 'notifications.read' : 'notifications.unread') | translate }}
        </span>
      </div>

      <p class="notification-card__message">{{ notification.message }}</p>

      <div class="notification-card__actions">
        <a
          mat-button
          *ngIf="notification.appointmentId"
          [routerLink]="['/dashboard/appointments', notification.appointmentId, 'audit']">
          {{ 'actions.viewAudit' | translate }}
        </a>

        <button
          mat-stroked-button
          type="button"
          *ngIf="!notification.isRead"
          [disabled]="markingAll || markingNotificationId === notification.userNotificationId"
          (click)="markNotificationAsRead(notification)">
          <mat-progress-spinner *ngIf="markingNotificationId === notification.userNotificationId" diameter="16" mode="indeterminate"></mat-progress-spinner>
          <span>{{ 'actions.markAsRead' | translate }}</span>
        </button>
      </div>
    </mat-card>
  </section>
</section>
