<section class="appointment-audit-page">
  <header class="audit-hero">
    <p class="eyebrow">{{ 'appointmentAudit.eyebrow' | translate }}</p>
    <h1>{{ 'appointmentAudit.title' | translate }}</h1>
    <p>{{ 'appointmentAudit.subtitle' | translate:{ appointmentId: appointmentId } }}</p>

    <a mat-stroked-button [routerLink]="backRoute">{{ 'actions.backToAppointments' | translate }}</a>
  </header>

  @if (loading) {
    <p class="state">{{ 'appointmentAudit.loading' | translate }}</p>
  }
  @if (errorMessage) {
    <p class="error">{{ errorMessage | translate }}</p>
  }

  @if (!loading && !errorMessage && auditEvents.length === 0) {
    <section class="empty-state">
      {{ 'appointmentAudit.empty' | translate }}
    </section>
  }

  @if (!loading && auditEvents.length > 0) {
    <section class="audit-list">
      @for (event of auditEvents; track trackAuditEvent($index, event)) {
        <mat-card class="audit-card">
          <div class="audit-card__head">
            <strong>{{ eventTypeLabel(event.eventType) | translate }}</strong>
            <span>{{ event.occurredAtUtc | date:'dd/MM/yyyy HH:mm' }}</span>
          </div>
          <p class="audit-card__details">{{ event.details }}</p>
          @if (event.actorName || event.actorRole) {
            <p class="audit-card__actor">
              {{ 'appointmentAudit.actor' | translate }}:
              {{ event.actorName || ('roles.user' | translate) }}
              @if (event.actorRole) {
                <span>({{ event.actorRole }})</span>
              }
            </p>
          }
        </mat-card>
      }
    </section>
  }
</section>
